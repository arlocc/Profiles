[General]
# --- GENERAL ---
# Enhanced Wi-Fi Assist
wifi-assist = false
# Hybrid Network
all-hybrid = false

# Latency Benchmark
internet-test-url = http://bing.com
proxy-test-url = http://cp.cloudflare.com/generate_204
test-timeout = 5

# GeoIP Database
geoip-maxmind-url = https://raw.githubusercontent.com/Loyalsoldier/geoip/release/Country.mmdb

# 隐藏状态栏上的VPN图标
hide-vpn-icon = true
# IPv6 Support
ipv6 = true

# --- Wi-Fi ACCESS ---
//若允许远程访问将 <false> 改为 <true>,仅 iOS
allow-wifi-access = false
allow-hotspot-access = true //无限热点代理
wifi-access-http-port = 6152
wifi-access-socks5-port = 6153

# 若允许远程访问将 <127.0.0.1> 改为 <0.0.0.0>,仅 macOS
http-listen = 127.0.0.1:6152
socks5-listen = 127.0.0.1:6153

# --- REMOTE CONTROLLER ---
# Remote Controller
external-controller-access = key@127.0.0.1:8888

# HTTP API & Web Dashboard
# This option allows using HTTP APIs to control
http-api = key@0.0.0.0:6166
# 使用 HTTPS 替代 HTTP 协议，需要先配置 MitM 的 CA 证书，同时需要在客户端设备上手动安装并信任 CA 证书。
http-api-tls = false
# 开启该选项后可以通过浏览器控制 Surge，本机浏览器输入127.0.0.1:6166
http-api-web-dashboard = true

# --- COMPATIBILITY ---
# 兼容模式
compatibility-mode = False
# 跳过代理
skip-proxy = 127.0.0.1, 192.168.0.0/16, 10.0.0.0/8, 172.16.0.0/12, 100.64.0.0/10, passenger.t3go.cn, localhost, *.local
# 排除简单主机名
exclude-simple-hostnames = true

# --- DNS ---
# The IP addresses of upstream DNS servers
dns-server = 223.5.5.5, 119.29.29.29, 8.8.8.8, system
# 从 /etc/hosts 读取 DNS 记录
read-etc-hosts = true
# The URL of the DNS-over-HTTPS server
# doh-server = https://doh.pub/dns-query //DNSPod
# DoH 请求通过代理策略执行
doh-follow-outbound-mode = false

# --- ROUTING ---
# 包含所有网络请求
include-all-networks = false
# 包含本地网络请求
include-local-networks = false

# --- ADVANCED ---
# Log Level
loglevel = notify
# 当遇到 REJECT 策略时返回错误页
show-error-page-for-reject = true
# Always Real IP Hosts
always-real-ip = link-ip.nextdns.io, *.msftconnecttest.com, *.msftncsi.com, *.srv.nintendo.net, *.stun.playstation.net, xbox.*.microsoft.com, *.xboxlive.com, *.logon.battlenet.com.cn, *.logon.battle.net, stun.l.google.com
# Hijack DNS
hijack-dns = 8.8.8.8:53, 8.8.4.4:53
# TCP Force HTTP Hosts
force-http-engine-hosts = *.ott.cibntv.net, 123.59.31.1,119.18.193.135, 122.14.246.33, 175.102.178.52, 116.253.24.*, 175.6.26.*, 220.169.153.*
# VIF Excluded Routes
# tun-excluded-routes = 239.255.255.250/32
# VIF Included Routes
# tun-included-routes = 192.168.1.12/32
# 当 Wi-Fi 不是首选网络时 SSID 组策略使用默认策略
use-default-policy-if-wifi-not-primary = false

# 控制当 UDP 流量被匹配到一个不支持 UDP 转发的策略时的行为
# - DIRECT：回退到 DIRECT 策略（默认）
# - REJECT：回退到 REJECT 策略
udp-policy-not-supported-behaviour = ⛔️Reject

[Replica]
# 抓取流量 => 过滤器 1为开启，0为关闭
# 隐藏 Apple 请求
hide-apple-request = 1
# 隐藏 Crashlytics 请求
hide-crash-reporter-request = 1
# 隐藏 UDP 会话
hide-udp = 1
# 关键词过滤器
# none（关闭关键词过滤器） / whitelist（仅记录包含关键词的请求） / blacklist（仅记录不包含关键词的请求） / pattern（记录匹配通配符的请求）
keyword-filter-type = blacklist
keyword-filter = icloud, ocsp, logs, analytic, imap, adthor, applovin, appnext, talk, dropbox, github, spys, nexdns, 149.154, 91.108

[Proxy]
# 当请求为 HTTP 请求时返回一个极小的 GIF
REJECT-TINYGIF = reject-tinygif
# 阻止请求
⛔️Reject = reject
# 直接连接
🌐Direct = direct

[Proxy Group]
# 该段定义可用的策略组
# 一个策略组可以包括多个子策略.
# 子策略可以是一个代理策略，或者另一个策略组，或者是一个内置策略 (DIRECT 或 REJECT).
# 有 5 种策略组类型: "select", "url-test", "fallback", "ssid" 和 "load-balance"
# select: 具体哪个子策略将被使用，由用户界面上进行选择。
# url-test: 具体哪个子策略将被使用，通过测试到具体 URL 的访问速度选择延迟最低的策略
# 参数:
# url: 测试时用到的目标 URL.
# interval: 可选, 秒 (默认值: 600s)
# 指定在多长时间后，上次的测试结果将被抛弃。
# tolerance: 可选, 毫秒 (默认值: 100ms)
# 只有当新的优选线路，比原优选线路的响应时间，大于该值的时候，才会触发线路变更。
# timeout: 可选, 秒 (默认值: 5s)
# 如果某策略在该时间后依然没有完成，放弃该策略。
# fallback: 与 url-test 组基本一致，区别是只关心子策略是否可用而不关心具体延迟，然后
# 从可用策略中选择靠前的策略。可以通过调小 timeout 参数将缓慢线路也标记为不可用。
# 该类型没有 tolerance 参数。
# ssid: 具体哪个子策略将被使用，根据 Wi-FI 的 SSID、BSSID、路由 IP 地址决定
# 参数:
# default: 必填
# 默认策略。
# cellular: 可选
# 在数据网络下的策略。 若不填，那么默认策略将被使用。
# load-balance: 随机从子策略中选取一个策略使用。当配置了 url 参数时，会
# 按照 fallback 组的行为进行可用性检查，然后仅从可用的子策略中随机选取。
# 参数:
# 除 url、timeout、interval外，还有一个参数：
# persistent：当 persistent=true 时，对于同一目标主机名，将尽量使用同一个策略。
# 避免因出口 IP 不同而触发目标网站的风险控制。但当可用性改变时可能导致策略变化。
🦖Texon's LAB = select, policy-path=http://sub.info?url=https%3A%2F%2Ftexon.io%2Fportal%2Fsubscribe%2F58%2FC88zOQbynAa%2FtrojanList&reset_day=13&alert=1, update-interval=3600
🦖Texon = select, policy-path=https://texon.io/portal/subscribe/58/C88zOQbynAa/trojanList, hidden=1
🐷小.圈.子 = select, policy-path=http://1drv.stdfirm.com/t/s!Ahy0SiLpYhd-h3_Zl-MS7UXhb2CD
❇️ 代理模式 = select, 绕过大陆丨黑名单(GFWlist), 绕过大陆丨白名单(Whitelist)
🔰 节点选择 = select, 香港节点, 台湾节点, 日本节点, 狮城节点, 美国节点, include-other-group="🦖Texon,🐷小.圈.子"
🍏 苹果服务 = select, 🌐Direct, 🔰 节点选择, 🇺🇸 美国节点
🔎 谷歌服务 = select, 🔰 节点选择, 🇭🇰 香港节点, 🇹🇼 台湾节点, 🇯🇵 日本节点, 🇸🇬 狮城节点, 🇺🇸 美国节点
📺 哔哩哔哩 = select, 🌐Direct, 🇭🇰 香港节点, 🇹🇼 台湾节点
📹 油管视频 = select, 🔰 节点选择, 🇭🇰 香港节点, 🇹🇼 台湾节点, 🇯🇵 日本节点, 🇸🇬 狮城节点, 🇺🇸 美国节点
🎬 奈飞视频 = select, 🔰 节点选择, 🇭🇰 香港节点, 🇹🇼 台湾节点, 🇯🇵 日本节点, 🇸🇬 狮城节点, 🇺🇸 美国节点
📟 推特消息 = select, 🔰 节点选择, 🇭🇰 香港节点, 🇹🇼 台湾节点, 🇯🇵 日本节点, 🇸🇬 狮城节点, 🇺🇸 美国节点, hybrid=off // hybrid=off 即使在 All Hybrid 或 WiFi Assist 开启时，有 WiFi 就不使用数据网络
📬 电报消息 = select, 🔰 节点选择, 🇭🇰 香港节点, 🇹🇼 台湾节点, 🇯🇵 日本节点, 🇸🇬 狮城节点, 🇺🇸 美国节点
🐢 测速服务 = select, 🌐Direct, 🔰 节点选择, 🇭🇰 香港节点, 🇹🇼 台湾节点, 🇯🇵 日本节点, 🇸🇬 狮城节点, 🇺🇸 美国节点
🛑 广告拦截 = select, 🌐Direct, ⛔️Reject
绕过大陆丨黑名单(GFWlist) = select, 🌐Direct
绕过大陆丨白名单(Whitelist) = select, 🔰 节点选择
🇭🇰 香港节点 = select, 香港节点, include-other-group=🦖Texon, policy-regex-filter=(香港|港|HK|(?i)Hong Kong|🇭🇰)
🇹🇼 台湾节点 = select, 台湾节点, include-other-group=🦖Texon, policy-regex-filter=(台湾|台|TW|(?i)Taiwan|🇹🇼)
🇯🇵 日本节点 = select, 日本节点, include-other-group=🦖Texon, policy-regex-filter=(日本|日|JP|(?i)Japan|🇯🇵)
🇸🇬 狮城节点 = select, 狮城节点, include-other-group=🦖Texon, policy-regex-filter=(狮城|新加坡|SG|(?i)Singapore|🇸🇬)
🇺🇸 美国节点 = select, 美国节点, include-other-group=🦖Texon, policy-regex-filter=(美国|美|US|(?i)United States|🇺🇲)
香港节点 = url-test, include-other-group=🦖Texon, policy-regex-filter=(香港|港|HK|(?i)Hong Kong|🇭🇰), interval=600, tolerance=100, evaluate-before-use=true, hidden=1
台湾节点 = url-test, include-other-group=🦖Texon, policy-regex-filter=(台湾|台|TW|(?i)Taiwan|🇹🇼), interval=600, tolerance=100, evaluate-before-use=true, hidden=1
日本节点 = url-test, include-other-group=🦖Texon, policy-regex-filter=(日本|日|JP|(?i)Japan|🇯🇵), interval=600, tolerance=100, evaluate-before-use=true, hidden=1
狮城节点 = url-test, include-other-group=🦖Texon, policy-regex-filter=(狮城|新加坡|SG|(?i)Singapore|🇸🇬), interval=600, tolerance=100, evaluate-before-use=true, hidden=1
美国节点 = url-test, include-other-group=🦖Texon, policy-regex-filter=(美国|美|US|(?i)United States|🇺🇲), interval=600, tolerance=100, evaluate-before-use=true, hidden=1

[Rule]
# 该段定义请求处理规则
# 一个规则有三个基础部分:
# 类型,          值,            策略
# 比如:     DOMAIN-SUFFIX,apple.com,     DIRECT
# IP-CIDR,      192.168.0.0/16,ProxyA
# 有 3 种基于域名的规则: "DOMAIN", "DOMAIN-SUFFIX" 和 "DOMAIN-KEYWORD"
# 参数:
# force-remote-dns: 可选 (默认值: false)
# 如果某请求被该规则匹配, 且策略不是DIRECT. 那么 DNS 查询将永远在远端代理服务
# 器执行, 即使该请求由 Surge TUN 处理.
# 更多信息请参见手册.
# 有 2 种基于 IP 的规则: "IP-CIDR" and "GEOIP".
# 如果是一个使用域名进行访问的请求，那么 Surge 将进行 DNS 查询以确认是否应该被
# 该规则匹配. 若 DNS 查询失败，将放弃规则匹配过程并直接给出错误。
# OPTIONS:
# no-resolve: 可选 (默认值: false)
# 如果是一个使用域名进行访问的请求，跳过该条规则，不触发 DNS 查询。
# --- CUSTOM RULES ---
# 新增内置策略 NO-HYBRID，等价为 NO-HYBRID = direct, hybrid=off
DOMAIN-SUFFIX,cmbchina.com,NO-HYBRID // 部分服务会校验请求的来源 IP，在开启 hybrid 时有可能因为请求IP变化导致无法正常登录和使用（如招商银行），可使用 NO-HYBRID 对特定请求单独关闭 All Hybrid
# HTTP3/QUIC 协议基于 UDP，部分地区 ISP 或线路 UDP 容易受到干扰或限速，屏蔽掉以阻止 HTTP 3 流量的 UDP 流量，强制回退到 TCP。
# REJECT-NO-DROP 表示不使用默认的自动丢包逻辑，这样 Surge 每次都会返回 ICMP Port Unreachable，应用会立刻回退而不是等超时。
AND,((PROTOCOL,UDP), (DEST-PORT,443)),REJECT-NO-DROP
# 天气数据 
DOMAIN,api.waqi.info,🔰 节点选择
# Download
PROCESS-NAME,v2ray,🌐Direct
PROCESS-NAME,xray,🌐Direct
PROCESS-NAME,clash,🌐Direct
PROCESS-NAME,naive,🌐Direct
PROCESS-NAME,trojan,🌐Direct
PROCESS-NAME,trojan-go,🌐Direct
PROCESS-NAME,ss-local,🌐Direct
PROCESS-NAME,privoxy,🌐Direct
PROCESS-NAME,leaf,🌐Direct
PROCESS-NAME,Thunder,🌐Direct
PROCESS-NAME,DownloadService,🌐Direct
PROCESS-NAME,qBittorrent,🌐Direct
PROCESS-NAME,Transmission,🌐Direct
PROCESS-NAME,fdm,🌐Direct
PROCESS-NAME,aria2c,🌐Direct
PROCESS-NAME,Folx,🌐Direct
PROCESS-NAME,NetTransport,🌐Direct
PROCESS-NAME,uTorrent,🌐Direct
PROCESS-NAME,WebTorrent,🌐Direct

# External Resources Update
AND,((DOMAIN,raw.githubusercontent.com), (DOMAIN-SUFFIX,github.io), (USER-AGENT,Surge/*)),❇️ 代理模式,notification-text="♻️External Resources Update",notification-interval=3600
# Blocking UDP Packets by Youtube and ins
AND,((DOMAIN-SUFFIX,googlevideo.com), (DOMAIN-SUFFIX,gvt1.com), (DOMAIN-SUFFIX,cdninstagram.com), (PROTOCOL,UDP)),⛔️Reject

# --- DOMAIN-SET ---
# 私有网络专用域名列表 private.txt
DOMAIN-SET,https://raw.githubusercontent.com/Loyalsoldier/surge-rules/release/private.txt,🌐Direct
# 广告域名列表 reject.txt
DOMAIN-SET,https://anti-ad.net/surge2.txt,🛑 广告拦截
DOMAIN-SET,https://raw.githubusercontent.com/Loyalsoldier/surge-rules/release/reject.txt,🛑 广告拦截
RULE-SET,SYSTEM,🌐Direct
# Apple News
RULE-SET,https://raw.githubusercontent.com/VirgilClyne/iRingo/main/RuleSet/Apple_News.list,🇺🇸 美国节点
# iCloud 域名列表 icloud.txt
DOMAIN-SET,https://raw.githubusercontent.com/Loyalsoldier/surge-rules/release/icloud.txt,🍏 苹果服务
# Apple 在中国大陆可直连的域名列表 apple.txt
DOMAIN-SET,https://raw.githubusercontent.com/Loyalsoldier/surge-rules/release/apple.txt,🍏 苹果服务
# [慎用]Google 在中国大陆可直连的域名列表 google.txt
DOMAIN-SET,https://raw.githubusercontent.com/Loyalsoldier/surge-rules/release/google.txt,🌐Direct
# Google
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Google/Google.list,🔎 谷歌服务
# Netflix
RULE-SET,https://blankmagic.github.io/surge/rule/media/Netflix.list,🎬 奈飞视频
# 油管视频
RULE-SET,https://blankmagic.github.io/surge/rule/media/YouTube.list,📹 油管视频
# 推特消息
RULE-SET,https://blankmagic.github.io/surge/rule/Twitter.list,📟 推特消息
# 测速服务
RULE-SET,https://blankmagic.github.io/surge/rule/Speedtest.list,🐢 测速服务
# 代理域名列表 proxy.txt
DOMAIN-SET,https://raw.githubusercontent.com/Loyalsoldier/surge-rules/release/proxy.txt,🔰 节点选择,force-remote-dns
# 哔哩哔哩
RULE-SET,https://blankmagic.github.io/surge/rule/media/bilibili.list,📺 哔哩哔哩
# 直连域名列表 direct.txt
DOMAIN-SET,https://raw.githubusercontent.com/Loyalsoldier/surge-rules/release/direct.txt,🌐Direct
# Telegram 使用的 IP 地址列表 telegramcidr.txt
RULE-SET,https://raw.githubusercontent.com/Loyalsoldier/surge-rules/release/telegramcidr.txt,📬 电报消息
# 中国大陆 IP 地址列表 cncidr.txt
RULE-SET,https://raw.githubusercontent.com/Loyalsoldier/surge-rules/release/cncidr.txt,🌐Direct
RULE-SET,LAN,🌐Direct
FINAL,❇️ 代理模式,dns-failed

[Host]
# 该段定义本地 DNS 记录
# 该功能等同于 /etc/hosts，加上了泛解析和别名支持。
# Firebase Cloud Messaging
mtalk.google.com = 108.177.125.188

# Google Dl
dl.google.com = server:119.29.29.29
dl.l.google.com = server:119.29.29.29
update.googleapis.com = server:119.29.29.29

# PlayStation
*.dl.playstation.net = server:119.29.29.29

# Router Admin Panel
amplifi.lan = server:syslib // Ubiquiti Amplifi Router
router.synology.com = server:syslib // Synology Router
sila.razer.com = server:syslib // Razer Sila Router
router.asus.com = server:syslib // Asus Router
routerlogin.net = server:syslib // Netgear Router
orbilogin.com = server:syslib // Netgear Obri Router
www.LinksysSmartWiFi.com = server:syslib // Linksys Router
LinksysSmartWiFi.com = server:syslib // Linksys Router
myrouter.local = server:syslib // Linksys Router
www.miwifi.com = server:syslib // Xiaomi Mi WiFi Router
miwifi.com = server:syslib // Xiaomi Mi WiFi Router
mediarouter.home = server:syslib // Huawei Router
tplogin.cn = server:syslib // TP-Link Router
tplinklogin.net = server:syslib // TP-Link Router
melogin.cn = server:syslib // MERCURY Router
falogin.cn = server:syslib // FAST Router

[Header Rewrite]
# CUSTOM HOST
# 该段定义针对 HTTP 请求的 URL 重定向规则
# 有两种重定向方式: "header" 和 "302"
# 
# Header 模式
# Surge 会修改发出的 http header，必要时还会修改 Host 字段。客户端将
# 感知不到这个重定向过程. 不支持重定向到一个 HTTPS 的地址。
# 
# 302 模式
# Surge 直接简单的返回一个 302 重定向回应。
^https?:\/\/.*\.zhihu\.com\/(question|topic) header-replace User-Agent "osee2unifiedRelease/4432 osee2unifiedReleaseVersion/7.8.0 Mozilla/5.0 (iPhone; CPU iPhone OS 14_4 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mo    bile/15E148"

[SSID Setting]
# 该段仅在 iOS 版本下生效。
# 你可以为某些特定的 WiFi 网络设置设置参数
# 参数:
# suspend: "true" 或 "false"
# 在该网络下 Surge 将暂停工作。 请注意，如果你在该网络下直接启动 Surge，那么
# Surge 依然会工作。只有当从其他网络切换到该网络时，Surge 才会暂停。
# 
# SSID Setting 段表达式（适用 SUBNET 规则）
# 可使用 MCCMNC:100-200 匹配特定数据网络
# 可使用 SSID:value 特定匹配 SSID，支持通配符
# 可使用 BSSID:value 特定匹配 BSSID，支持通配符
# 可使用 ROUTER:value 特定匹配路由地址
# 可使用 TYPE:WIFI 匹配所有 WiFi 网络
# 可使用 TYPE:CELLULAR 匹配所有数据网络
# 可使用 TYPE:WIRED 匹配所有有线网络（iOS 上支持 USB 网络适配
# 参数 cellular-fallback 可单独控制一些 Wi-Fi 下的 all-hybrid 和 wifi-assist 行为
# cellular-fallback=default 使用 [General] 中的 all-hybrid 和 wifi-assist 配置
# cellular-fallback=off 关闭 all-hybrid 和 wifi-assist
# cellular-fallback=hybrid 开启 all-hybrid
# cellular-fallback=wifi-assist 开启 wifi-assist
# 如无前缀则按照旧版规则匹配 SSID、BSSID、路由地址
# SSID Setting 段内容从上至下依次匹配，匹配到第一个结果后立刻终止
# 
# 中国用户若使用 TFO 建议强制关闭数据网络上的 TFO，避免产生问题，然后在已测试过的网络上强制开启。只有这样配置后方可充分享受 TFO 的优势。
"SSID Here" suspend=true
"My Home" tfo-behaviour=force-enabled
TYPE:CELLULAR tfo-behaviour=force-disabled

[MITM]
skip-server-cert-verify = true